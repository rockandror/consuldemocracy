<% cache [locale_and_user_status, @current_order, commentable_cache_key(@proposal), @comment_tree.comments, @comment_tree.comment_authors, @proposal.comments_count] do %>
  <div class="row comments">
    <div id="comments" class="small-12 column">
      <%= render "shared/wide_order_selector", i18n_namespace: "comments" %>

      <% if user_signed_in? && can_add_comments?(@proposal) %>
        <%= render "comments/form", { commentable: @proposal, parent_id: nil } %>
      <% elsif user_signed_in? && @proposal.voting_in_review? %>
        <br>
        <div data-alert class="callout primary">
          <%= sanitize(t("proposals.comments.pending_to_review_proposal")) %>
        </div>
      <% elsif user_signed_in? && @proposal.voting_disabled? %>
        <br>
        <div data-alert class="callout primary">
          <%= sanitize(t("proposals.comments.disabled_proposal")) %>
        </div>
      <% else %>
        <br>
        <%= render "shared/login_to_comment" %>
      <% end %>

      <%= render "comments/comment_list", comments: @comment_tree.root_comments %>
      <%= paginate @comment_tree.root_comments %>
    </div>
  </div>
<% end %>
